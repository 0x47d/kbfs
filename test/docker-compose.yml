kbweb:
    image: kbweb
    ports:
        - "3000:3000"
dynamodb:
    image: dynamodb
    expose:
        - "8000"
mdserver:
    image: kbserver
    ports:
        - "8125:8125"
    volumes:
        - $GOPATH/bin:/opt/keybase:ro
        - $GOPATH/src/github.com/keybase/kbfs/test:/opt/scripts:ro
    links:
        - kbweb
        - dynamodb
    restart: unless-stopped
    environment:
        KBFS_BIND_ADDR: '0.0.0.0:8125'
    entrypoint: sh -c "KBFS_TLS_KEY=$$(cat /opt/scripts/docker_key.pem) KBFS_TLS_CERTIFICATE=$$(cat /opt/scripts/docker_cert.pem) /opt/keybase/mdserver"
bserver:
    image: kbserver
    ports:
        - "8225:8225"
    volumes:
        - $GOPATH/bin:/opt/keybase:ro
        - $GOPATH/src/github.com/keybase/kbfs/test:/opt/scripts:ro
    links:
        - kbweb
        - dynamodb
        - mdserver
    restart: unless-stopped
    environment:
        KBFS_BIND_ADDR: '0.0.0.0:8225'
    entrypoint: sh -c "BSERVER_USE_MEMORY_STORE=1 KBFS_TLS_KEY=$$(cat /opt/scripts/docker_key.pem) KBFS_TLS_CERTIFICATE=$$(cat /opt/scripts/docker_cert.pem) /opt/keybase/bserver"
keybase:
    image: keybase
    volumes:
        - $GOPATH/bin:/opt/keybase:ro
        - $GOPATH/src/github.com/keybase/kbfs/test:/opt/scripts:ro
    links:
        - kbweb
        - mdserver
        - bserver
    privileged: true
    entrypoint: keybase_docker_setup.sh
